# 📝 项目复盘报告 (24h Sprint)

### ✅ 开发里程碑
- **0-6h**：确立“梦境杂货铺”核心 Vibe，完成 UI 框架搭建。
- **6-12h**：接入 Gemini 2.5 API，调教多模态输出的一致性。
- **12-20h**：开发勋章系统、TTS 语音补丁及离线保底逻辑。
- **20-24h**：文档编写、安全性加密及最后打包测试。

### 🛠️ 遇到的挑战与解决方案
- **挑战**：本地 `file://` 协议运行导致图标分离。
- **对策**：引入动态图标库驱动补丁，强制重绘。
- **挑战**：AI 语气初期过于生硬。
- **对策**：通过 Vibe Coding 迭代 15 个版本的 System Prompt，最终确立治愈系文风。

### 🚀 未来展望
计划引入 **Web Audio API**，根据梦境素材实时生成随机生成的 8-bit 背景音乐，增强沉浸感。
计划增加杂货铺店内店外场景切换，昼夜转换以及订单的不同
开场翻页动画及契约书
3维度评分算法（匹配度+创意度+适度性）

原claude开发详细计划如下：
# 梦境杂货铺核心规格  
## 1. 核心概念  
- **定位**：治愈系创意造梦游戏，玩家用“魔法线团”（关键词）通过“织布机”编织“梦境画卷”（Canvas），治愈小镇小动物噩梦，存档分享。  
- **隐喻**：生活褶皱=负面情绪，杂货铺=造梦工坊，线团=关键词，织布机=输入工具，画卷=梦境画面。  

## 2. 新手教程（融合版三段式）  
### Step 1：开场引导（情感共鸣）  
- **文案**（用户确认版）：  
  > "嘿，你好呀～ 我是梦境杂货铺的主理人小梦。你有没有过这样的时刻？白天的烦恼像一团乱麻，夜里躺下时，心里还留着几个小小的褶皱——也许是没做完的梦，也许是想忘又忘不掉的小情绪，像乌云一样轻轻压着胸口。其实呀，在我住的小镇上，那些可爱的小动物邻居们也有这样的褶皱。小松鼠住在松果屋里，小兔子在胡萝卜园里蹦跳，小刺猬最爱在枫叶林里打滚… 他们白天都很快乐，可一到夜里，有些小动物也会被噩梦悄悄找上门。于是我开了这样一间杂货铺，用元素魔法为大家制作梦境。看着它们幸福的笑容，我明白，这不仅能治愈自己，也能守护别人。这就是我们梦境杂货铺的使命，那么现在，你愿意和我一起努力，传递这份美好吗？下面我向你展示一个我以前制造过的梦，作为示范吧~"  
- **UI**：羊皮纸纹理背景（Claude生成`parchment.png`），手写字体（Google Fonts“Indie Flower”），逐段淡入动画（CSS `fadeIn 1s`），底部“Next”复古纽扣（CSS `border: 2px solid #8B4513; border-radius: 50%`）。  

### Step 2：示例展示（3个示范梦）  
- **梦1：天空早餐铺**  
  - 组合：云（自然）+ 棉花糖船（人造）（跨域组合）  
  - 解说："用【云（自然）+ 棉花糖船（人造）】跨域组合，像天空开了间早餐铺，烦恼来了也能咬一口甜～"  
  - Canvas：云（浅蓝#f0f9ff）+ 棉花糖船（粉白#fff5f5，Claude生成SVG），背景天空蓝渐变。  
- **梦2：惊喜盲盒**  
  - 组合：糖果山（巨大）+ 萤火虫（微小）（反差萌）  
  - 解说："【糖果山（巨大）+ 萤火虫（微小）】反差萌，像梦里的惊喜盲盒，拆开全是光～"  
  - Canvas：糖果山（玫红#ffd1dc）+ 萤火虫（黄#ffeb3b，动态闪烁），背景浅紫#f3e5f5。  
- **梦3：游动的梦**  
  - 组合：鲸鱼（动态）+ 喷水（动作）（动态场景）  
  - 解说："加【鲸鱼喷水（动态）】让梦游起来，水珠都闪着‘你可以放松啦’的信号～"  
  - Canvas：鲸鱼（蓝#87ceeb）+ 喷水（白#ffffff，CSS动画`drop 1s infinite`），背景深海蓝#1e3a8a。  
- **交互**：5秒自动切换（CSS `setInterval`）+ 手动Skip按钮，魔法书翻页动画（CSS `rotateY(180deg)`）。  

### Step 3：使命接受（契约书+玩家名）  
- **UI**：契约书样式（羊皮纸背景+火漆印章📜，Claude生成`seal.png`），含“梦境守护者契约”正文：  
  > "我，______，愿意成为梦境杂货铺的造梦师，用元素魔法为小镇小动物织美梦，也给自己缝补内心的褶皱。从今以后，每个关键词都是我的魔法线团，每幅梦境都是我的治愈礼物。—— 立誓人：小梦 & ______"  
- **玩家名输入**：手写输入框（placeholder“请写下你的造梦师名字～”，校验非空，未输入提示“没有名字的造梦师会迷路哦～”）。  
- **存储**：`localStorage.playerName = 输入值 || '匿名造梦师'`，作为分享落款来源。  
- **按钮**：“接受使命”（金色纽扣）、“再想想”（灰色纽扣，返回Step 1）。  

## 3. 核心玩法  
### 织布机输入区（替代打字机）  
- **UI**：左侧线团架（Flexbox网格，Claude生成线团图标：云☁️绿#4CAF50、船⛵蓝#2196F3、星星✨粉#E91E63），中央织布机（Claude生成`loom.png`木箱+金属梭子SVG，梭子=光标），右侧Canvas画卷（300x300，羊皮纸纹理）。  
- **交互**：点击线团自动输入关键词，输入时梭子“穿梭”动画（CSS `left: 0→100%`，音效“咔嗒”声），删除时“抽线”动画（反向移动，音效“嘶啦”声），完成输入织布机“收线”存档（Canvas截图`toDataURL`）。  

### Canvas绘图  
- **元素绘制**：封装`drawElement(ctx, type, x, y)`，用Claude生成SVG路径（如云=“M50,50 Q70,30 90,50 T130,50”）。  
- **实时更新**：输入关键词时清空重绘，元素按序“织”在画卷上（间距10px）。  

### 订单系统  
- **订单队列**：`let orders = []`（Claude生成5个初始订单，含小动物头像SVG、心愿文案）。  
- **UI**：右上角信封📩（Claude生成`envelope.svg`），新订单时小红点●闪烁（CSS `opacity: 0.5→1`循环），hover提示“你有1个新订单～”。  
- **弹窗**：信笺样式（米白底色+手写字体），含：  
  - 顾客形象：小刺猬球球🦔（16x16像素复古SVG，Claude生成）。  
  - 心愿描述：“球球：我想梦见枫叶桥不断，黑洞里有萤火虫灯～”（小动物口吻）。  
  - 接单按钮：“开始织梦”（复古纽扣）。  

### 3维度评分  
- **匹配度(40%)**：用户输入与订单核心词相关性（如“枫叶桥”匹配度+30%）。  
- **创意度(35%)**：跨域/反差/动态/情感组合（如“自然+人造”+20%）。  
- **适度性(25%)**：元素数量3-5个（最佳+25%，超5个-10%）。  

## 4. 勋章系统（即时评定+动画）  
### 勋章类型与触发条件  
| 勋章         | 触发条件（本次订单）                | 奖励                | 动画效果（CSS @keyframes）                  | 提示文案（用户确认版）                          |  
|--------------|-------------------------------------|---------------------|---------------------------------------------|-------------------------------------------------|  
| 跨域探险家   | 自然+人造元素组合（如云+船）         | 解锁“彩虹桥”        | 旋转360°+金色光芒闪烁（`box-shadow: 0 0 20px gold`） | “你用【云+船】跨域组合，创造了天空早餐梦～”        |  
| 反差大师     | 巨大+微小元素组合（如山+萤火虫）     | 金币+10             | 同上                                        | “【糖果山+萤火虫】反差萌，像梦里的惊喜盲盒～”      |  
| 动态造梦师   | 含动作元素（如鲸鱼喷水）             | 分享卡片加动态特效  | 同上                                        | “【鲸鱼喷水】让梦游起来，水珠都闪着‘放松啦’的信号～”|  
| 心灵捕手     | 情感共鸣组合（如月亮秋千+星星毯）     | 顾客评价标“暖心”标签| 同上                                        | “【月亮秋千+星星毯】裹着温柔，像妈妈的怀抱～”      |  

### 提示设计  
- **弹窗**：信笺式小弹窗（居中显示3秒，自动淡出），含勋章图标（Claude生成SVG）、故事化解说文案。  

## 5. 分享与存档  
### 分享卡片（温暖版）  
- **结构**：  
  - 标题：《松果云上的星星毯：小松鼠的云端野餐》（诗意比喻，Claude生成）。  
  - 故事：“云铺成床，棉花糖船载萤火虫旅行，像躺在云里吃早餐”（场景叙事，Claude生成）。  
  - 落款：“—— 造梦师[玩家名]❤️（小梦代笔）”（玩家名加粗深粉#ff69b4，小梦代笔灰色#999小字）。  
- **禁用**：创意分、元素数量等冰冷信息。  

### 梦境档案馆  
- **存档范围**：所有完成梦境（含未分享），自动记录：时间戳、关键词、画面快照（`canvas.toDataURL`）、顾客评价、勋章、分享状态。  
- **浏览方式**：相册式网格（老照片边框PNG，Claude生成），按时间/创意分排序，点击缩略图弹出“梦境信笺”详情页。  

## 6. 场景切换与昼夜  
### 外部造型（小镇街角复古木屋）  
- **外观**：尖顶木质小屋（Claude生成`house-day.png`白天/`house-night.png`夜晚，512x512），挂手写招牌“梦境杂货铺”+小梦头像🐰（16x16像素SVG），左侧橱窗展示热门梦境模型（云船、糖果山微缩景观），右侧信箱📬（新订单闪烁红光），窗台摆多肉🌵+干花🌸（像素图标）。  
- **昼夜差异**：白天阳光斑驳（格子窗光影CSS `clip-path: polygon(...)`），夜晚橱窗暖光+烟囱飘星星炊烟✨（CSS粒子动画）。  

### 内部陈设（造梦工坊）  
- **分区**：中央造梦工作台（羊皮纸木桌+织布机+Canvas画卷）、左侧元素货架（玻璃罐盛放已解锁元素，未解锁🔒锁+梦晶标价）、右侧记忆展柜（复古相框+暖心匣子📦=档案馆入口）、桌角藤编信箱📩（取手写信笺订单）、角落小梦沙发🛋️+八音盒🎵。  

### 场景切换逻辑  
- **外部→内部**：点击木屋正门（🚪，门把手=魔法线团铜环），3D推门动画（CSS `rotateY(-90deg)`+“吱呀”音效）。  
- **内部→外部**：点击右侧橱窗（☀️/🌙图标），开窗淡入外部街景（日景/夜景图层），内部虚化（半透明遮罩）。  
- **昼夜切换**：手动按钮🌞/🌙，全局样式切换（白天马卡龙色+自然光，夜晚暖棕+台灯光），体验差异（白天愿望订单，夜晚噩梦救援）。